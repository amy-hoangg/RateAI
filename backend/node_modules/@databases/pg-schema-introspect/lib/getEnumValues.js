"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

const pg_1 = require("@databases/pg");

const getTypes_1 = require("./getTypes");

async function getEnumValues(connection, query) {
  const conditions = getTypes_1.typeQuery(query);
  const enumValues = await connection.query(pg_1.sql`
    SELECT
      ns.oid AS "schemaID",
      ns.nspname AS "schemaName",
      ty.oid AS "typeID",
      ty.typname AS "typeName",
      e.enumlabel AS "value"
    FROM pg_catalog.pg_enum e
    INNER JOIN pg_catalog.pg_type ty
      ON (e.enumtypid = ty.oid)
    INNER JOIN pg_catalog.pg_namespace ns
      ON (ty.typnamespace = ns.oid)
    LEFT OUTER JOIN pg_catalog.pg_type subt
      ON (ty.typelem = subt.oid)
    ${conditions.length ? pg_1.sql`WHERE ${pg_1.sql.join(conditions, pg_1.sql` AND `)}` : pg_1.sql``}
    ORDER BY ns.nspname ASC, ty.typname ASC, e.enumlabel ASC
  `);
  return enumValues;
}

exports.default = getEnumValues;